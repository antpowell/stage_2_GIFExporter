{"version":3,"sources":["src\\gif.exporter.single.worker.ts","src\\game.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA,IAAA,+BAAA,QAAA,8BAAA,CAAA;AACA,IAAA,OAAA,aAAA,YAAA;AAQC,ADTD,IAAA,SCSC,IAAA,ADTD,CCSa,YDTb,CCSC,EAAiC,SDTlC;ACUE,ADFD,aCEM,ADFN,OCEC,GAAe,ADFhB,CAAY,MAAZ,ECEyB,ADFW,OAApC,EAAmF,KCEnE,CAAwB,aAAxB,CAAf;AACA,ADFA,aCEK,ADFA,OCEL,ADFA,GCEe,ADFA,ICEI,GDFG,KCEK,MAAZ,CAAmB,KAAK,CDFxB,EAAf,ICEe,EAAiC,IAAjC,EAAuC;AACrD,ADFD,aAAK,MAAL,GAAc,QAAQ,KCEE,ADFxB;ACCsD,ADAtD,SCAe,CAAf,GDAK,SAAL,GAAiB,QAAQ,QAAzB;ACGA,ADFA,aCEK,YAAL,GAAoB,IAAI,6BAAA,UAAJ,CAAe,KAAK,OAApB,EAA6B;AAChD,ADDK,eAAA,ICCE,EADyC,GDA3C,CAAA,KAAA,GAAP,YAAA;ACEE,ADFF,YAAA,QAAA,ECEY,EDFZ;ACAkD,ADCjD,SCDoB,CAApB,KDCO,IAAI,OAAJ,CAAY,UAAO,OAAP,EAAgB,MAAhB,EAAsB;ACGzC,ADHyC,mBAAA,UAAA,KAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,EAAA,YAAA;ACK1C,SAAA,SAAA,CAAA,WAAA,GAAA,YAAA;AACC;AACA,aAAK,MAAL,GAAc,IAAI,QAAQ,KAAZ,CAAkB,KAAK,OAAvB,CAAd;AAEA,ADRC,yBAAK,IAAL;ACSD,ADRC,aCQI,OAAL,GAAe,IAAI,CDRV,GAAR,CAAY,GCQc,UAAZ,CAAuB,CDRrC,QCQc,EAAkC,IAAI,QAAQ,OAAZ,CAAoB,CAApB,EAAuB,CAAvB,EAA0B,CAAC,EAA3B,CAAlC,EAAkE,KAAK,MAAvE,CAAf;AAEA,ADTO,sCAAgC,EAAhC;ACUP,ADTK,aCSA,OAAL,CAAa,SAAb,CAAuB,GDTJ,KCSY,OAAR,ADTQ,CCSQ,IAAhB,EAAvB,KDT+B;ACW/B,ADX+B,+BAAA,UAAA,KAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,EAAA,YAAA;ACY/B,aAAK,OAAL,CAAa,aAAb,CAA2B,KAAK,OAAhC,EAAyC,KAAzC;AAEA;AACA,aAAK,MAAL,GAAc,IAAI,QAAQ,gBAAZ,CAA6B,QAA7B,EAAuC,IAAI,QAAQ,OAAZ,CAAoB,CAApB,EAAuB,CAAvB,EAA0B,CAA1B,CAAvC,EAAqE,KAAK,MAA1E,CAAd;AAEA;AACA,ADjBE,YCiBE,SAAS,QAAQ,WAAR,CAAoB,IDjB/B,CAAA,KAAA,ECiBW,CACZ,QADY,EAEZ,EDnBC,EAAgB,IAAhB;ACoBA,ADpBqB,sBCoBX,EADX,uBDnBsB,CAAA,CAAA,CAAA,SAAA,EAAM,KAAK,QAAL,EAAN,CAAA;ACqBrB,sBAAU;AAFX,ADnBC,SCiBW,EAMZ,KAAK,MANO,CAAb,oBDjBE,KAAA,CAAA,EAAA,EAAA,CAAqB,GAAA,IAAA,EAArB,CAAA;AC0BF;AACA,eAAO,QAAP,CAAgB,CAAhB,GAAoB,CAApB;AAEA;AACA,YAAI,SAAS,ID/BkB,CAAA,GC+BV,WAAR,CAAoB,YAApB,CACZ,QADY,EAEZ;AACC,ADhCA,mBCgCO,CADR,CDjCkB,EAEf,KAAK,MAFU,CAAd;ACmCH,ADhCD,oBCgCS,CAFT,UD9BW,YAAA;ACiCV,ADhCA,0BCgCc,YDhCA,WAAd;AC6BD,AD5BC,SC0BW,EAOZ,KAAK,MAPO,CAAb,KD1BQ,SAAS,IAAI,MAAJ,CAAW,sCAAX,CAAf;ACmCF,ADlCE,KCLH,yBDKQ,QAAL,GAAgB,EAAE,KAAK,WAAP,EAAoB,QAAQ,EAAE,QAAQ,eAAV,EAA2B,OAAO,MAAK,MAAvC,EAA+C,QAAQ,MAAK,OAA5D,EAA5B,EAAhB;ACoCH,ADnCG,SCmCH,SAAA,CAAA,QAAA,GAAA,CDnCU,WCmCV,ADnCG,CAAmB,MAAK,QAAxB;ACmCH,ADlCG,YCkCH,QAAA,IAAA,ODlCU,SAAP,GAAmB,UAAC,EAAD,EAAsB;ACmC3C,gCDnCgC,UAAA,GAAA,IAAA,CAAA;ACoChC,ADnCG,aCmCE,OAAL,CAAa,aAAb,CAA2B,CDnChB,OAAR,ICmCwB;AAC1B,ADnCE,kBCmCG,MAAL,CAAY,ADrCX,MCqCD;AACA,ADnCC,SCiCF,YDzCC,EAQG,KAAK,SARR;AC6CD;AACA,eAAO,gBAAP,CAAwB,QAAxB,EAAkC,YAAA;AACjC,aDtDwC,CAAA,ICsDnC,OAAL,CAAa,MAAb;AACA,ADvCA,SCqCD,ADrDO,CAAP;ACwDA,ADvCA,KC6BD,AD/CO;AC2DP,ADvCO,SCuCP,MDvCO,GCuCP,CAAA,KDvCO,CAAA,IAAA,CCuCP,EDvCA,CCuCA,WDvCA,CCuCA,ADvCsB,CAAf;ACwCN,ADtCM,aCsCD,EDtCC,SAAA,CCsCN,ADtCM,CCsCY,KDtCZ,GCsCN,ADtCD,YAAA,CAAwB,CAAjB;ACuCN,ADrCY,KCmCb,UDnCa,SAAA,CAAA,QAAA,GAAb,UAAsB,QAAtB,EAAgD;ACsChD,ADtCsB,SCsCtB,GDtCsB,MCsCtB,CAAA,MDtCsB,CCsCtB,GAAA,CDtCsB,CAAA,EAAA,QCsCtB;AACC,ADvCqB,aCuChB,UDvCgB,ECuCrB,CAAkB,KAAlB,ODvCqB;ACwCrB,ADxC+C,KCsChD;AAGD,WAAA,IAAA,wBDzCoD,SAAO,YAAA;ACrC3D,CAAA,EAAA;AAAa,QAAA,IAAA,GAAA,IAAA;AAgFb,OAAO,gBAAP,CAAwB,kBAAxB,EAA4C,YAAA;AAC3C,QAAM,YAA+B,SAAS,cAAT,CAAwB,WAAxB,CAArC;AACA,AD5Ca,QC4CP,UAAU,SAAS,ID5CZ,CAAA,CAAA,CAAA,OC4CG,CAAwB,CD5C3B,EAAM,KAAK,IC4CR,CAAhB,AD5CmB,EAAN,CAAA;AC6Cb;AAEA,AD/CO,8BAAM,GAAA,IAAA,EAAN;ACgDP,AD/CO,QC+CH,OAAO,IAAI,IAAJ,CAAS,MD/CP,IAAI,IC+CN,CAAX,UD/Ca,CACX,IAAI,IAAJ,CAAS,CAAC,IAAI,UAAJ,CAAe,GAAf,CAAD,CAAT,EAAgC;ACgDlC,AD/CG,kCAAM;ACgDT,ADjDkC,SCiD7B,WAAL,KDjDE,CADW,CAAN;ACoDP,AD/CO,mCAAW,SAAS,aAAT,CAAuB,GAAvB,CAAX;ACgDP,AD/CC,SC+CI,QAAL,gBD/CU,IAAT,CAAc,WAAd,CAA0B,QAA1B;ACiDD,ADhDC,cCgDS,gBAAV,CAA2B,EDhDjB,KCgDV,CDhDC,CCgDmC,EDhDjB,QAAlB,ECgDmC;AACnC,ADhDA,aCgDK,WAAL,SDhDS,YAAT,CAAsB,QAAtB,EAAgC,QAAhC;ACiDA,ADhDA,KC8CD,4BD9CU,KAAT,CAAe,OAAf,GAAyB,MAAzB;ACiDD,ADhDC,YCgDO,gBAAR,CAAyB,IDhDf,GCgDV,CDhDC,CCgDiC,EDhDjB,GAAhB,OCgDiC;AACjC,ADhDA,aCgDK,OAAL,aDhDS,QAAT,GAAoB,QAApB;ACiDA,ADhDA,KC8CD,4BD9CU,KAAT;ACiDD,ADhDC,CC4BF,2BD5BM,eAAJ,CAAoB,GAApB;AACA,iCAAS,aAAT,CAAuB,WAAvB,CAAmC,QAAnC;;;;;AACA,KAjBY;AAmBL,eAAA,SAAA,CAAA,QAAA,GAAR,YAAA;AAAA,YAAA,QAAA,IAAA;AACC,eAAO,IAAI,OAAJ,CAAY,UAAO,OAAP,EAAgB,MAAhB,EAAsB;AAAA,mBAAA,UAAA,KAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,EAAA,YAAA;;;AAClC,yBAAK,KAAK,OAAL,CAAa,UAAb,CAAwB,QAAxB,KAAqC,KAAK,OAAL,CAAa,UAAb,CAAwB,OAAxB,CAA1C;AACF,6BAAS,IAAI,UAAJ,CAAe,KAAK,MAAL,GAAc,KAAK,OAAnB,GAA6B,CAA5C,CAAT;AACJ,uBAAG,UAAH,CAAc,CAAd,EAAiB,CAAjB,EAAoB,KAAK,MAAzB,EAAiC,KAAK,OAAtC,EAA+C,GAAG,IAAlD,EAAwD,GAAG,aAA3D,EAA0E,MAA1E;AACA,4BAAQ,MAAR;;;aAJwC,CAAA;AAKxC,SALM,CAAP;AAMA,KAPO;AASA,eAAA,SAAA,CAAA,IAAA,GAAR,YAAA;AACC,aAAK,MAAL,GAAc,KAAK,OAAL,CAAa,KAA3B;AACA,aAAK,OAAL,GAAe,KAAK,OAAL,CAAa,MAA5B;AACA,KAHO;AAIT,WAAA,UAAA;AAtEA,CAAA,EAAA;AAAa,QAAA,UAAA,GAAA,UAAA","file":"game.87537101.map","sourceRoot":"..","sourcesContent":["export class GIFCreator {\r\n\tprivate _canvas: HTMLCanvasElement;\r\n\tprivate _delay: number;\r\n\tprivate _duration: number;\r\n\tprivate _width: number;\r\n\tprivate _height: number;\r\n\tprivate _message: { job: string; params?: {} };\r\n\r\n\tconstructor(engine: BABYLON.Engine, options?: { delay?: number; duration?: number }) {\r\n\t\tthis._canvas = engine.getRenderingCanvas();\r\n\t\tthis._delay = options.delay;\r\n\t\tthis._duration = options.duration;\r\n\t}\r\n\r\n\tpublic start(): Promise<number[]> {\r\n\t\treturn new Promise(async (resolve, reject) => {\r\n\t\t\tthis.init();\r\n\t\t\tconsole.log('record canvas');\r\n\t\t\tconst frameCollection: Uint8Array[] = [];\r\n\t\t\tlet intervalRef = setInterval(async () => {\r\n\t\t\t\tframeCollection.push(await this.getFrame());\r\n\t\t\t}, this._delay);\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tclearInterval(intervalRef);\r\n\t\t\t\tconst worker = new Worker('./gif.creator.service.ts');\r\n\t\t\t\tthis._message = { job: 'createGIF', params: { frames: frameCollection, width: this._width, height: this._height } };\r\n\t\t\t\tworker.postMessage(this._message);\r\n\t\t\t\tworker.onmessage = ({ data: { gifData } }) => {\r\n\t\t\t\t\tresolve(gifData);\r\n\t\t\t\t};\r\n\t\t\t}, this._duration);\r\n\t\t});\r\n\t}\r\n\r\n\tpublic stop(): void {}\r\n\r\n\tpublic cancel(): void {}\r\n\r\n\tpublic async download(filename = 'canvasGIF.gif'): Promise<void> {\r\n\t\tconst gif = await this.start();\r\n\t\tconst url = URL.createObjectURL(\r\n\t\t\tnew Blob([new Uint8Array(gif)], {\r\n\t\t\t\ttype: 'image/gif',\r\n\t\t\t})\r\n\t\t);\r\n\t\tconst download = document.createElement('a');\r\n\t\tdocument.body.appendChild(download);\r\n\t\tdownload.target = '_blank';\r\n\t\tdownload.setAttribute('target', '_blank');\r\n\t\tdownload.style.display = 'none';\r\n\t\tdownload.href = url;\r\n\t\tdownload.download = filename;\r\n\t\tdownload.click();\r\n\t\tURL.revokeObjectURL(url);\r\n\t\tdownload.parentElement.removeChild(download);\r\n\t}\r\n\r\n\tprivate getFrame(): Promise<Uint8Array> {\r\n\t\treturn new Promise(async (resolve, reject) => {\r\n\t\t\tconst gl = this._canvas.getContext('webgl2') || this._canvas.getContext('webgl');\r\n\t\t\tlet pixels = new Uint8Array(this._width * this._height * 4);\r\n\t\t\tgl.readPixels(0, 0, this._width, this._height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\r\n\t\t\tresolve(pixels);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate init() {\r\n\t\tthis._width = this._canvas.width;\r\n\t\tthis._height = this._canvas.height;\r\n\t}\r\n}\r\n","import { GIFCreator } from './gif.exporter.single.worker';\nexport class Game {\n\tprivate _canvas: HTMLCanvasElement;\n\tprivate _engine: BABYLON.Engine;\n\tprivate _scene: BABYLON.Scene;\n\tprivate _camera: BABYLON.FreeCamera;\n\tprivate _light: BABYLON.Light;\n\tprivate _gifExporter: GIFCreator;\n\n\tconstructor(canvasElement: string) {\n\t\tthis._canvas = document.getElementById(canvasElement) as HTMLCanvasElement;\n\t\tthis._engine = new BABYLON.Engine(this._canvas, true, {\n\t\t\tpreserveDrawingBuffer: true,\n\t\t});\n\t\tthis._gifExporter = new GIFCreator(this._engine, {\n\t\t\tdelay: 60,\n\t\t\tduration: 5000,\n\t\t});\n\t}\n\n\tcreateScene(): void {\n\t\t// Create a basic BJS Scene object.\n\t\tthis._scene = new BABYLON.Scene(this._engine);\n\n\t\t// Create a FreeCamera, and set its position to (x:0, y:5, z:-10).\n\t\tthis._camera = new BABYLON.FreeCamera('camera1', new BABYLON.Vector3(0, 5, -10), this._scene);\n\n\t\t// Target the camera to scene origin.\n\t\tthis._camera.setTarget(BABYLON.Vector3.Zero());\n\n\t\t// Attach the camera to the canvas.\n\t\tthis._camera.attachControl(this._canvas, false);\n\n\t\t// Create a basic light, aiming 0,1,0 - meaning, to the sky.\n\t\tthis._light = new BABYLON.HemisphericLight('light1', new BABYLON.Vector3(0, 1, 0), this._scene);\n\n\t\t// Create a built-in \"sphere\" shape; with 16 segments and diameter of 2.\n\t\tlet sphere = BABYLON.MeshBuilder.CreateSphere(\n\t\t\t'sphere',\n\t\t\t{\n\t\t\t\tsegments: 16,\n\t\t\t\tdiameter: 2,\n\t\t\t},\n\t\t\tthis._scene\n\t\t);\n\n\t\t// Move the sphere upward 1/2 of its height.\n\t\tsphere.position.y = 1;\n\n\t\t// Create a built-in \"ground\" shape.\n\t\tlet ground = BABYLON.MeshBuilder.CreateGround(\n\t\t\t'ground',\n\t\t\t{\n\t\t\t\twidth: 6,\n\t\t\t\theight: 6,\n\t\t\t\tsubdivisions: 2,\n\t\t\t},\n\t\t\tthis._scene\n\t\t);\n\t}\n\n\tdoRender(): void {\n\t\t// Run the render loop.\n\t\tthis._engine.runRenderLoop(() => {\n\t\t\tthis._scene.render();\n\t\t});\n\n\t\t// The canvas/window resize event handler.\n\t\twindow.addEventListener('resize', () => {\n\t\t\tthis._engine.resize();\n\t\t});\n\t}\n\n\tdownloadGIF() {\n\t\tthis._gifExporter.download();\n\t}\n\tstopGIF() {\n\t\tthis._gifExporter.start();\n\t}\n}\n\nwindow.addEventListener('DOMContentLoaded', () => {\n\tconst recordBtn: HTMLCanvasElement = document.getElementById('recordBtn') as HTMLCanvasElement;\n\tconst stopBtn = document.getElementById('recStopBtn');\n\t// Setup GIF generator\n\n\t// Create the game using the 'renderCanvas'.\n\tlet game = new Game('renderCanvas');\n\n\t// Create the scene.\n\tgame.createScene();\n\n\t// Start render loop.\n\tgame.doRender();\n\n\trecordBtn.addEventListener('click', () => {\n\t\tgame.downloadGIF();\n\t});\n\tstopBtn.addEventListener('click', () => {\n\t\tgame.stopGIF();\n\t});\n});\n"]}