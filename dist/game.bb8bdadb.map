{"version":3,"sources":["src\\EncodedImage.ts","src\\GIFGenerator.ts","src\\ColorTableGenerator.ts","src\\GIFExporter.ts","src\\game.ts"],"names":[],"mappings":"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","file":"game.bb8bdadb.map","sourceRoot":"..","sourcesContent":["export class EncodedImage {\r\n\tdata: number[] = [];\r\n\r\n\tconstructor() {}\r\n\r\n\tget() {\r\n\t\treturn this.data as number[];\r\n\t}\r\n\r\n\twrite(byte: number) {\r\n\t\tthis.data.push(byte);\r\n\t}\r\n\r\n\twriteArray(array: number[], arraySize: number) {\r\n\t\tfor (let i = 0; i < arraySize; i++) {\r\n\t\t\tthis.write(array[i]);\r\n\t\t}\r\n\t}\r\n\r\n\twriteUTF(UTF: string) {\r\n\t\tfor (let i = 0; i < UTF.length; i++) {\r\n\t\t\tthis.write(UTF.charCodeAt(i));\r\n\t\t}\r\n\t}\r\n\r\n\twriteColor(color: string) {\r\n\t\tfor (let i = 0; i < color.length; i += 2) {\r\n\t\t\tconst intValue: number = parseInt(color[i] + color[i + 1], 16);\r\n\t\t\tthis.write(intValue);\r\n\t\t}\r\n\t}\r\n\r\n\twriteLittleEndian(num: number) {\r\n\t\tthis.write(num & 0xff);\r\n\t\tthis.write((num >> 8) & 0xff);\r\n\t}\r\n}\r\n","import { EncodedImage } from './EncodedImage';\r\n///<reference path = 'JS/LZWEncoder.js'/>\r\n\r\nexport class GIFGenerator {\r\n\tstream: EncodedImage = new EncodedImage();\r\n\tbyteCount: number = 0;\r\n\twidth: number;\r\n\theight: number;\r\n\tencodedImage: EncodedImage = new EncodedImage();\r\n\tframeIndexedPixels: number[];\r\n\tframeCount: number = 0;\r\n\tGCT: string[];\r\n\r\n\tconstructor(width: number, height: number, GCT: string[]) {\r\n\t\tthis.width = width;\r\n\t\tthis.height = height;\r\n\t\tthis.GCT = GCT;\r\n\t\tconsole.log(`Generator now running...`);\r\n\t}\r\n\r\n\tinit() {\r\n\t\tthis.headerGenerator();\r\n\t\tthis.LSDGenerator();\r\n\t\tthis.GCTWriter();\r\n\t\tthis.AppExtGenerator();\r\n\t}\r\n\r\n\tgenerateFrame(indexedPixels: number[], frameCount?: number) {\r\n\t\tthis.frameIndexedPixels = indexedPixels;\r\n\t\tthis.frameCount += 1;\r\n\t\tconsole.log(`generating frame ${this.frameCount}`);\r\n\t\tthis.GCEGenerator();\r\n\t\tthis.imgDescGenerator();\r\n\t\tthis.imgDataGenerator();\r\n\t}\r\n\r\n\tdownload(filename: string) {\r\n\t\tthis.TrailerGenerator();\r\n\r\n\t\tconsole.log('downloading');\r\n\t\tconsole.log(this.stream);\r\n\r\n\t\tconst download = document.createElement('a');\r\n\t\tdownload.download = filename;\r\n\t\tdownload.href = URL.createObjectURL(\r\n\t\t\tnew Blob([new Uint8Array(this.stream.get())], {\r\n\t\t\t\ttype: 'image/gif'\r\n\t\t\t})\r\n\t\t);\r\n\t\tdownload.click();\r\n\t}\r\n\r\n\theaderGenerator() {\r\n\t\tthis.stream.writeUTF('GIF89a'); /* GIF Header */\r\n\t}\r\n\r\n\tLSDGenerator() {\r\n\t\tthis.stream.writeLittleEndian(this.width); /* Canvas Width */\r\n\t\tthis.stream.writeLittleEndian(this.height); /* Canvas Height */\r\n\t\tthis.stream.write(0xf7); /* Packed Field */\r\n\t\tthis.stream.write(0); /* Background Color Index */\r\n\t\tthis.stream.write(0); /* Pixel Aspect Ration */\r\n\t}\r\n\r\n\tGCEGenerator() {\r\n\t\tthis.stream.write(0x21); /* Extension Introducer */\r\n\t\tthis.stream.write(0xf9); /* Graphic Control Label */\r\n\t\tthis.stream.write(0x4); /* Byte Size */\r\n\t\tthis.stream.write(0x4); /* Packed Field */\r\n\t\tthis.stream.writeLittleEndian(0x32); /* Delay Time */\r\n\t\tthis.stream.write(0x0); /* Transparent Color Index */\r\n\t\tthis.stream.write(0x0); /* Block Terminator */\r\n\t}\r\n\r\n\timgDescGenerator() {\r\n\t\tthis.stream.write(0x2c); /* Image Seperator Always 2C */\r\n\t\tthis.stream.writeLittleEndian(0x0); /* Image Left */\r\n\t\tthis.stream.writeLittleEndian(0x0); /* Image Top */\r\n\t\tthis.stream.writeLittleEndian(this.width); /* Image Width */\r\n\t\tthis.stream.writeLittleEndian(this.height); /* Image Height */\r\n\t\tthis.stream.write(0x0); /* Block Terminator */\r\n\t}\r\n\r\n\tAppExtGenerator() {\r\n\t\tthis.stream.write(0x21); /* extension introducer */\r\n\t\tthis.stream.write(0xff); /* app extension label */\r\n\t\tthis.stream.write(11); /* block size */\r\n\t\tthis.stream.writeUTF('NETSCAPE' + '2.0'); /* app id + auth code */\r\n\t\tthis.stream.write(3); /* sub-block size */\r\n\t\tthis.stream.write(1); /* loop sub-block id */\r\n\t\tthis.stream.writeLittleEndian(\r\n\t\t\t0\r\n\t\t); /* loop count (extra iterations, 0=repeat forever) */\r\n\t\tthis.stream.write(0); /* Block Terminator */\r\n\t}\r\n\r\n\tTrailerGenerator() {\r\n\t\tthis.stream.write(0x3b); /* Trailer Marker */\r\n\t\tconsole.log(`Generator now finished.`);\r\n\t}\r\n\r\n\tGCTWriter() {\r\n\t\tlet count = 0;\r\n\r\n\t\tthis.GCT.forEach(color => {\r\n\t\t\tcount += 3;\r\n\t\t\tthis.stream.writeColor(color);\r\n\t\t});\r\n\r\n\t\tfor (let i = count; i < 3 * 256; i++) {\r\n\t\t\tthis.stream.write(0);\r\n\t\t}\r\n\t}\r\n\r\n\timgDataGenerator() {\r\n\t\tconst encoder = new LZWEncoder(\r\n\t\t\tthis.width,\r\n\t\t\tthis.height,\r\n\t\t\tthis.frameIndexedPixels,\r\n\t\t\t8\r\n\t\t);\r\n\t\tencoder.encode(this.stream);\r\n\t\tconsole.log(`completed frame ${this.frameCount}`);\r\n\t}\r\n\r\n\tLCTGenerator() {}\r\n\r\n\tPlainTextExtGenerator() {}\r\n\r\n\tCommentExtGenerator() {}\r\n\r\n\twriteLittleEndian(num: number) {\r\n\t\tthis.stream.write(num & 0xff);\r\n\t\tthis.stream.write((num >> 8) & 0xff);\r\n\t}\r\n}\r\n","export class ColorTableGenerator {\r\n\tprivate _colorTable: string[] = [];\r\n\tprivate _distribution = 51;\r\n\tprivate _colorLookup: {\r\n\t\t[index: string]: number;\r\n\t} = {};\r\n\r\n\tgenerate() {\r\n\t\tlet count = 0;\r\n\t\tfor (let red: number = 0; red < 256; red += this._distribution) {\r\n\t\t\tfor (let green: number = 0; green < 256; green += this._distribution) {\r\n\t\t\t\tfor (let blue: number = 0; blue < 256; blue += this._distribution) {\r\n\t\t\t\t\tconst pixel = this.pad(red) + this.pad(green) + this.pad(blue);\r\n\r\n\t\t\t\t\tthis._colorTable.push(pixel);\r\n\r\n\t\t\t\t\tthis._colorLookup[pixel] = count;\r\n\r\n\t\t\t\t\tcount++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {\r\n\t\t\t_colorLookup: this._colorLookup,\r\n\t\t\t_colorTable: this._colorTable\r\n\t\t};\r\n\t}\r\n\r\n\tprivate pad(color: number) {\r\n\t\tif (color < 16) {\r\n\t\t\treturn `0${color.toString(16)}`;\r\n\t\t} else {\r\n\t\t\treturn color.toString(16);\r\n\t\t}\r\n\t}\r\n}\r\n","import { GIFGenerator } from './GIFGenerator';\r\nimport { ColorTableGenerator } from './ColorTableGenerator';\r\nexport class GIFExporter {\r\n\tprivate _engine: BABYLON.Engine;\r\n\tprivate _canvas: HTMLCanvasElement;\r\n\tprivate _delay: number;\r\n\tprivate _duration: number;\r\n\tprivate _GCT: string[];\r\n\tprivate _intervalRef: number;\r\n\tprivate _width: number;\r\n\tprivate _height: number;\r\n\tprivate _imageDataCollection: Uint8Array[] = [];\r\n\tprivate _gifGenerator: GIFGenerator;\r\n\tprivate _colorLookUpTable: { [index: string]: number };\r\n\r\n\tconstructor(\r\n\t\tengine: BABYLON.Engine,\r\n\t\toptions?: { delay?: number; duration?: number; GCT?: string[] }\r\n\t) {\r\n\t\tconst colorGenerator = new ColorTableGenerator().generate();\r\n\t\tthis._engine = engine;\r\n\t\tthis._canvas = engine.getRenderingCanvas();\r\n\t\tthis._delay = options.delay;\r\n\t\tthis._duration = options.duration;\r\n\t\tthis._GCT = options.GCT || colorGenerator._colorTable;\r\n\t\tthis._colorLookUpTable = colorGenerator._colorLookup;\r\n\t\tthis._width = engine.getRenderWidth();\r\n\t\tthis._height = engine.getRenderHeight();\r\n\t\tthis._gifGenerator = new GIFGenerator(this._width, this._height, this._GCT);\r\n\t\tthis._gifGenerator.init();\r\n\t}\r\n\tstart() {\r\n\t\tconsole.log('​GIFExporter3 -> start -> ');\r\n\t\treturn new Promise(async (resolve, reject) => {\r\n\t\t\tawait this.getSnapShotDataFromCanvas();\r\n\r\n\t\t\tconsole.log('setupImg complete');\r\n\r\n\t\t\tawait this.processFrames(this._imageDataCollection);\r\n\t\t\tconsole.log(`finished`, this._imageDataCollection);\r\n\t\t\tresolve();\r\n\t\t});\r\n\t}\r\n\r\n\tstop() {\r\n\t\tconsole.log('​GIFExporter3 -> stop -> ');\r\n\t\tclearInterval(this._intervalRef);\r\n\t}\r\n\r\n\tasync download() {\r\n\t\tconsole.log('​GIFExporter3 -> download -> ');\r\n\t\tawait this.start();\r\n\t\tthis._gifGenerator.download('testingGE3.gif');\r\n\t}\r\n\r\n\tprivate getSnapShotDataFromCanvas() {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis._intervalRef = setInterval(() => {\r\n\t\t\t\tconst gl =\r\n\t\t\t\t\tthis._canvas.getContext('webgl2') || this._canvas.getContext('webgl');\r\n\t\t\t\tconst pixels = new Uint8Array(\r\n\t\t\t\t\tgl.drawingBufferWidth * gl.drawingBufferHeight * 4\r\n\t\t\t\t);\r\n\t\t\t\tgl.readPixels(\r\n\t\t\t\t\t0,\r\n\t\t\t\t\t0,\r\n\t\t\t\t\tgl.drawingBufferWidth,\r\n\t\t\t\t\tgl.drawingBufferHeight,\r\n\t\t\t\t\tgl.RGBA,\r\n\t\t\t\t\tgl.UNSIGNED_BYTE,\r\n\t\t\t\t\tpixels\r\n\t\t\t\t);\r\n\t\t\t\tthis._imageDataCollection.push(pixels);\r\n\t\t\t}, this._delay);\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis.stop();\r\n\t\t\t\tresolve();\r\n\t\t\t}, this._duration);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate processFrames(imageDataCollection: Uint8Array[]) {\r\n\t\tconsole.log('​GIFExporter3 -> privateprocessFrames -> ');\r\n\t\tnew Promise(async (resolve, reject) => {\r\n\t\t\tlet count = imageDataCollection.length;\r\n\t\t\timageDataCollection.forEach(async imgData => {\r\n\t\t\t\timgData = (await this.flipFrame(imgData)) as Uint8Array;\r\n\t\t\t\tconst rgbData = this.removeAlpha(imgData);\r\n\t\t\t\tconst indexedData = this.mapPixelIndex(rgbData);\r\n\t\t\t\tthis._gifGenerator.generateFrame(indexedData);\r\n\t\t\t\tif (--count === 0) resolve();\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tprivate flipFrame(frame: Uint8Array) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst split =\r\n\t\t\t\t(this._height / 2) |\r\n\t\t\t\t0; /* | 0 faster version of Math.floor for positive numbers */\r\n\t\t\tconst bytesPerRow = this._width * 4;\r\n\r\n\t\t\t// make a temp buffer to hold one row\r\n\t\t\tvar row = new Uint8Array(this._width * 4);\r\n\t\t\tfor (var rowIndex = 0; rowIndex < split; ++rowIndex) {\r\n\t\t\t\tvar topOffset = rowIndex * bytesPerRow;\r\n\t\t\t\tvar bottomOffset = (this._height - rowIndex - 1) * bytesPerRow;\r\n\r\n\t\t\t\t// make copy of a row on the top half\r\n\t\t\t\trow.set(frame.subarray(topOffset, topOffset + bytesPerRow));\r\n\r\n\t\t\t\t// copy a row from the bottom half to the top\r\n\t\t\t\tframe.copyWithin(topOffset, bottomOffset, bottomOffset + bytesPerRow);\r\n\r\n\t\t\t\t// copy the copy of the top half row to the bottom half\r\n\t\t\t\tframe.set(row, bottomOffset);\r\n\r\n\t\t\t\tif (rowIndex < split) resolve(frame);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprivate removeAlpha(colorArray: Uint8ClampedArray) {\r\n\t\tlet RGBPixelData: string[] = [];\r\n\t\tfor (let i = 0; i < colorArray.length; i += 4) {\r\n\t\t\tconst pixel =\r\n\t\t\t\tthis.pad(this.snapColor(colorArray[i])) +\r\n\t\t\t\tthis.pad(this.snapColor(colorArray[i + 1])) +\r\n\t\t\t\tthis.pad(this.snapColor(colorArray[i + 2]));\r\n\r\n\t\t\tRGBPixelData.push(pixel);\r\n\t\t}\r\n\r\n\t\treturn RGBPixelData;\r\n\t}\r\n\r\n\tprivate pad(color: number) {\r\n\t\tif (color < 16) {\r\n\t\t\treturn `0${color.toString(16)}`;\r\n\t\t} else {\r\n\t\t\treturn color.toString(16);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate snapColor(color: number) {\r\n\t\tif (color % 51 > Math.floor(51 / 2)) {\r\n\t\t\tcolor += 51 - (color % 51);\r\n\t\t} else {\r\n\t\t\tcolor -= color % 51;\r\n\t\t}\r\n\t\treturn color;\r\n\t}\r\n\r\n\tprivate mapPixelIndex(rgbData: string[]) {\r\n\t\tconst indexedPixels: number[] = [];\r\n\t\trgbData.forEach(pixel => {\r\n\t\t\tindexedPixels.push(this._colorLookUpTable[pixel]);\r\n\t\t});\r\n\t\treturn indexedPixels;\r\n\t}\r\n}\r\n","import { GIFExporter } from './GIFExporter';\r\nexport class Game {\r\n\tprivate _canvas: HTMLCanvasElement;\r\n\tprivate _engine: BABYLON.Engine;\r\n\tprivate _scene: BABYLON.Scene;\r\n\tprivate _camera: BABYLON.FreeCamera;\r\n\tprivate _light: BABYLON.Light;\r\n\tprivate _gifExporter: GIFExporter;\r\n\r\n\tconstructor(canvasElement: string) {\r\n\t\tthis._canvas = document.getElementById(canvasElement) as HTMLCanvasElement;\r\n\t\tthis._engine = new BABYLON.Engine(this._canvas, true, {\r\n\t\t\tpreserveDrawingBuffer: true\r\n\t\t});\r\n\t\tthis._gifExporter = new GIFExporter(this._engine, {\r\n\t\t\tdelay: 60,\r\n\t\t\tduration: 1000\r\n\t\t});\r\n\t}\r\n\r\n\tcreateScene(): void {\r\n\t\t// Create a basic BJS Scene object.\r\n\t\tthis._scene = new BABYLON.Scene(this._engine);\r\n\r\n\t\t// Create a FreeCamera, and set its position to (x:0, y:5, z:-10).\r\n\t\tthis._camera = new BABYLON.FreeCamera(\r\n\t\t\t'camera1',\r\n\t\t\tnew BABYLON.Vector3(0, 5, -10),\r\n\t\t\tthis._scene\r\n\t\t);\r\n\r\n\t\t// Target the camera to scene origin.\r\n\t\tthis._camera.setTarget(BABYLON.Vector3.Zero());\r\n\r\n\t\t// Attach the camera to the canvas.\r\n\t\tthis._camera.attachControl(this._canvas, false);\r\n\r\n\t\t// Create a basic light, aiming 0,1,0 - meaning, to the sky.\r\n\t\tthis._light = new BABYLON.HemisphericLight(\r\n\t\t\t'light1',\r\n\t\t\tnew BABYLON.Vector3(0, 1, 0),\r\n\t\t\tthis._scene\r\n\t\t);\r\n\r\n\t\t// Create a built-in \"sphere\" shape; with 16 segments and diameter of 2.\r\n\t\tlet sphere = BABYLON.MeshBuilder.CreateSphere(\r\n\t\t\t'sphere',\r\n\t\t\t{\r\n\t\t\t\tsegments: 16,\r\n\t\t\t\tdiameter: 2\r\n\t\t\t},\r\n\t\t\tthis._scene\r\n\t\t);\r\n\r\n\t\t// Move the sphere upward 1/2 of its height.\r\n\t\tsphere.position.y = 1;\r\n\r\n\t\t// Create a built-in \"ground\" shape.\r\n\t\tlet ground = BABYLON.MeshBuilder.CreateGround(\r\n\t\t\t'ground',\r\n\t\t\t{\r\n\t\t\t\twidth: 6,\r\n\t\t\t\theight: 6,\r\n\t\t\t\tsubdivisions: 2\r\n\t\t\t},\r\n\t\t\tthis._scene\r\n\t\t);\r\n\t}\r\n\r\n\tdoRender(): void {\r\n\t\t// Run the render loop.\r\n\t\tthis._engine.runRenderLoop(() => {\r\n\t\t\tthis._scene.render();\r\n\t\t});\r\n\r\n\t\t// The canvas/window resize event handler.\r\n\t\twindow.addEventListener('resize', () => {\r\n\t\t\tthis._engine.resize();\r\n\t\t});\r\n\t}\r\n\r\n\tdownloadGIF() {\r\n\t\tthis._gifExporter.download();\r\n\t}\r\n\tstopGIF() {\r\n\t\tthis._gifExporter.start();\r\n\t}\r\n}\r\n\r\nwindow.addEventListener('DOMContentLoaded', () => {\r\n\tconst recordBtn: HTMLCanvasElement = document.getElementById(\r\n\t\t'recordBtn'\r\n\t) as HTMLCanvasElement;\r\n\tconst stopBtn = document.getElementById('recStopBtn');\r\n\t// Setup GIF generator\r\n\r\n\t// Create the game using the 'renderCanvas'.\r\n\tlet game = new Game('renderCanvas');\r\n\r\n\t// Create the scene.\r\n\tgame.createScene();\r\n\r\n\t// Start render loop.\r\n\tgame.doRender();\r\n\r\n\trecordBtn.addEventListener('click', () => {\r\n\t\tgame.downloadGIF();\r\n\t});\r\n\tstopBtn.addEventListener('click', () => {\r\n\t\tgame.stopGIF();\r\n\t});\r\n});\r\n"]}