{"version":3,"sources":["src\\gif.exporter.single.worker.ts"],"names":[],"mappings":"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","file":"gif.exporter.single.worker.1ae00eab.map","sourceRoot":"..","sourcesContent":["export class GIFCreator {\r\n\tprivate _canvas: HTMLCanvasElement;\r\n\tprivate _delay: number;\r\n\tprivate _duration: number;\r\n\tprivate _width: number;\r\n\tprivate _height: number;\r\n\tprivate _message: { job: string; params?: {} };\r\n\r\n\tconstructor(engine: BABYLON.Engine, options?: { delay?: number; duration?: number }) {\r\n\t\tthis._canvas = engine.getRenderingCanvas();\r\n\t\tthis._delay = options.delay;\r\n\t\tthis._duration = options.duration;\r\n\t}\r\n\r\n\tpublic start(): Promise<number[]> {\r\n\t\treturn new Promise(async (resolve, reject) => {\r\n\t\t\tthis.init();\r\n\t\t\tconsole.log('record canvas');\r\n\t\t\tconst frameCollection: Uint8Array[] = [];\r\n\t\t\tlet intervalRef = setInterval(async () => {\r\n\t\t\t\tframeCollection.push(await this.getFrame());\r\n\t\t\t}, this._delay);\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tclearInterval(intervalRef);\r\n\t\t\t\tconst worker = new Worker('./gif.creator.service.ts');\r\n\t\t\t\tthis._message = { job: 'createGIF', params: { frames: frameCollection, width: this._width, height: this._height } };\r\n\t\t\t\tworker.postMessage(this._message);\r\n\t\t\t\tworker.onmessage = ({ data: { gifData } }) => {\r\n\t\t\t\t\tresolve(gifData);\r\n\t\t\t\t};\r\n\t\t\t}, this._duration);\r\n\t\t});\r\n\t}\r\n\r\n\tpublic stop(): void {}\r\n\r\n\tpublic cancel(): void {}\r\n\r\n\tpublic async download(filename = 'canvasGIF.gif'): Promise<void> {\r\n\t\tconst gif = await this.start();\r\n\t\tconst url = URL.createObjectURL(\r\n\t\t\tnew Blob([new Uint8Array(gif)], {\r\n\t\t\t\ttype: 'image/gif',\r\n\t\t\t})\r\n\t\t);\r\n\t\tconst download = document.createElement('a');\r\n\t\tdocument.body.appendChild(download);\r\n\t\tdownload.target = '_blank';\r\n\t\tdownload.setAttribute('target', '_blank');\r\n\t\tdownload.style.display = 'none';\r\n\t\tdownload.href = url;\r\n\t\tdownload.download = filename;\r\n\t\tdownload.click();\r\n\t\tURL.revokeObjectURL(url);\r\n\t\tdownload.parentElement.removeChild(download);\r\n\t}\r\n\r\n\tprivate getFrame(): Promise<Uint8Array> {\r\n\t\treturn new Promise(async (resolve, reject) => {\r\n\t\t\tconst gl = this._canvas.getContext('webgl2') || this._canvas.getContext('webgl');\r\n\t\t\tlet pixels = new Uint8Array(this._width * this._height * 4);\r\n\t\t\tgl.readPixels(0, 0, this._width, this._height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\r\n\t\t\tresolve(pixels);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate init() {\r\n\t\tthis._width = this._canvas.width;\r\n\t\tthis._height = this._canvas.height;\r\n\t}\r\n}\r\n"]}